<html>

<head>
    <style>
        html{
            height:100%;
        }
        body {
            direction: rtl;
            height: 100%;
        }

.container{
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    height: 800px;
    align-items: start;
    align-content: start;
}
iframe{
    height:800px;
}
       .container > ol {
            width: 50%;
            margin: auto;
            min-height: 1024px;;
        }

        li {
            display: grid;
            grid-template-columns: 8fr 2fr;
            margin: 8px auto;
            border: solid 1px #BBB;
border-radius: 16px;;
        }
        li button{
            grid-column: span 2;
            font-size: 16pt;
            border-radius: 16px;
            background-color: cornflowerblue;
        }
    </style>
    REdox Payments
    <script>
        function add(query, name, value) {
            query.push(name + "=" + encodeURIComponent(value));
        }
        function buildQuery(config) {
            var baseUrl = "http://localhost:7071";
           baseUrl = "https://tranzila-redox-payment.azurewebsites.net"
            //"sum=57&userId=1&tenantId=1&currency=1&contact=yairyair&lang=il&recur_transaction=4"
            var query = [];
            add(query, "lang", "il");
            add(query, "success_url_address", baseUrl + "/api/Accept");
            add(query, "fail_url_address", baseUrl + "/api/Reject");
            add(query, "notify_url_address", baseUrl + "/api/Notify");

            add(query, "sum", config.Payment.Amount);
            //add(query, "recur_transaction", "4_approved");
            add(query, "tranmode", "AK");
            // add(query, "pdsec", config.Plan.Name);

            add(query, "agents", config.Payment.Agents);
            add(query, "userid", config.User.UserId);
            add(query, "tenantid", config.Tenant.Id);
            add(query, "accountid", config.Account.Id);
            add(query, "currency", 1);
            add(query, "contact", config.User.FullName);
            add(query, "email", config.User.Email)
            add(query, "phone", config.User.Phone)

            return query.join("&");
        }
        var userConfig = {
            User: {
                UserId: 1,
                FullName: "יאיר כהן",
                Email: "yair@redox.co.il",
                Phone: "0525239030"
            },
            Tenant: {
                Id: 1,
                Name: "החתמה דיגיטלית למתווכים בלה בלה בלה"
            },
            Account: {
                Id: 1
            }
        }
        var products = {
            "basic": {
                Plan: {
                    Name: "חבילת בסיס",
                    MonthlyFee: 57
                },

            }, "pro": {
                Plan: {
                    Name: "חבילה מורחבת",
                    MonthlyFee: 92
                },

            }
        };

setTimeout(function(){
        var janBilling =         [{ "Account": { "Id": 118, "Name": "ג'י פי נכסים" }, "Tenant": { "Id": 3808, "Name": "ג'י פי נכסים" }, "User": { "UserId": 3883, "FullName": "גיא פלד", "Email": "guyrealty@gmail.com", "Phone": "0547488803" }, "Payment": { "Amount": 57 }, "Plan": { "Id": 1, "Name": "חבילה בסיסית" } }, { "Account": { "Id": 177, "Name": "פלשין שרותי תיווך" }, "Tenant": { "Id": 2166, "Name": "פלשין שרותי תיווך" }, "User": { "UserId": 2179, "FullName": "מיכל", "Email": "flashin.m@gmail.com", "Phone": "0528233181" }, "Payment": { "Amount": 81 }, "Plan": { "Id": 3, "Name": "מורחבת בהנחה" } }, { "Account": { "Id": 190, "Name": "עמית גולדמן(נדל\"ן גולדמן)" }, "Tenant": { "Id": 4240, "Name": "עמית גולדמן(נדל\"ן גולדמן)" }, "User": { "UserId": 4351, "FullName": "עמית גולדמן(נדל\"ן גולדמן) נכסים השווים זהב", "Email": "amitgoldmen@gmail.com", "Phone": "0523171818" }, "Payment": { "Amount": 57 }, "Plan": { "Id": 14, "Name": "ברוקר מורחב" } }];
        var febBilling =[{"Account":{"Id":177,"Name":"פלשין שרותי תיווך"},"Tenant":{"Id":2166,"Name":"פלשין שרותי תיווך"},"User":{"UserId":2179,"FullName":"מיכל","Email":"flashin.m@gmail.com","Phone":"0528233181"},"Payment":{"Amount":81,"Agents":1}},{"Account":{"Id":184,"Name":"אלי בן דוד"},"Tenant":{"Id":3499,"Name":"אליהו בן דוד - ייזום ושיווק פרוייקטים"},"User":{"UserId":3546,"FullName":"אלי בן דוד","Email":"elibend220@gmail.com","Phone":"0525729070"},"Payment":{"Amount":69,"Agents":1}},{"Account":{"Id":208,"Name":"קלר וויליאמס ראשונים"},"Tenant":{"Id":3519,"Name":"קלר וויליאמס ראשונים"},"User":{"UserId":3566,"FullName":"יחיאל עובדיה","Email":"yechielovadia@gmail.com","Phone":"0525571902"},"Payment":{"Amount":250,"Agents":10}},{"Account":{"Id":118,"Name":"ג'י פי נכסים"},"Tenant":{"Id":3808,"Name":"ג'י פי נכסים"},"User":{"UserId":3883,"FullName":"גיא פלד","Email":"guyrealty@gmail.com","Phone":"0547488803"},"Payment":{"Amount":57,"Agents":1}},{"Account":{"Id":181,"Name":"פאר נדל\"ן"},"Tenant":{"Id":3851,"Name":"פאר נדל\"ן"},"User":{"UserId":3934,"FullName":"רוני סקנדרני","Email":"peernadlan@gmail.com","Phone":"050-7706207"},"Payment":{"Amount":57,"Agents":1}},{"Account":{"Id":190,"Name":"עמית גולדמן(נדל\"ן גולדמן)"},"Tenant":{"Id":4240,"Name":"עמית גולדמן(נדל\"ן גולדמן)"},"User":{"UserId":4351,"FullName":"עמית גולדמן(נדל\"ן גולדמן) נכסים השווים זהב","Email":"amitgoldmen@gmail.com","Phone":"0523171818"},"Payment":{"Amount":57,"Agents":1}},{"Account":{"Id":156,"Name":"HouseStory Real Estat"},"Tenant":{"Id":4366,"Name":"HouseStory Real Estat"},"User":{"UserId":4482,"FullName":"Chen Carmi","Email":"chen@housestory-il.com","Phone":"0549219004"},"Payment":{"Amount":49,"Agents":1}},{"Account":{"Id":183,"Name":"ב.א נדלן אשקלון"},"Tenant":{"Id":5773,"Name":"ערן בן אבו"},"User":{"UserId":5925,"FullName":"ערן בן אבו","Email":"eranben111@gmail.com","Phone":"0547404584"},"Payment":{"Amount":69,"Agents":1}}]
        
        var billing = febBilling;
        var host = document.getElementById("container");

        function bill() {
            
            var paymentConfig = JSON.parse(this.dataset["config"]);
            if (paymentConfig) {
                var selected = document.getElementById("selected");
                if (selected.childNodes[0]){
                this.parentNode.parentNode.appendChild(selected.childNodes[0]);
                }
                selected.appendChild(this.parentNode);
                var paymentFrame = document.getElementById("payment");
                var transilaUrl = "https://direct.tranzila.com/redox/iframenew.php";

                var query = buildQuery(paymentConfig);

                paymentFrame.src = transilaUrl + "?" + query;
            }
        }


        for (var i = 0; i < billing.length; i++) {
            var item = billing[i];
            var li = document.createElement("LI");
            li.innerHTML = `<b>${item.Account.Name}</b> (${item.Account.Id}) -  ${item.Payment.Amount} - ${item.User.FullName} (${item.User.Phone}) | ${item.Tenant.Id}`;
            var btn = document.createElement("BUTTON");
            btn.setAttribute("type", "button");
            btn.innerText = 'חייב';
            btn.dataset["config"] = JSON.stringify(item);
            btn.addEventListener("click", bill);
            li.appendChild(btn);
            host.appendChild(li);
        }
    }, 500)

        function takePayment(selected) {
            var config = products[selected];
            var paymentConfig = Object.assign({}, config, userConfig);
            var paymentFrame = document.getElementById("payment");
            var transilaUrl = "https://direct.tranzila.com/redox/iframenew.php";
            var query = buildQuery(paymentConfig);
            console.log("PAU", paymentConfig, query);
            paymentFrame.src = transilaUrl + "?" + query;
        }
    </script>
</head>

<body>
    <h1>REDOX</h1>
    <div class="container">
        <ol id="container"></ol>
        <div>
            <h1>Paying Now:</h1>
            <ol id="selected"></ol>
        <iframe id="payment" style="border:0;width:100%;height:600px" src=""></iframe>
    </div>

    </div>

</body>

</html>